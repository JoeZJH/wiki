---
title: "《重构：改善既有代码的设计》读书笔记"
layout: page
date: 2020-03-08
---

[TOC]

# 关于
《重构：改善既有代码的设计》马丁-福勒

# 第1章 重构，一个示例
- 如果你要给程序添加一个特性，但发现代码因缺乏良好的结构而不易于进行更改，那就先重构那个程序，使其比较容易添加该特性，然后再添加该特性。
- 重构前，先检查自己是否有一套可靠的测试集，这些测试必须有自我检验能力。
- 小步修改，每次修改后就运行测试；测试成功后马上提交
- 提炼函数，可以自动化完成的重构
- 傻瓜都能写出计算机可以理解的代码，唯有能写出人类容易理解的代码的，才是优秀的程序员
- 编程时，需要遵循营地法则：保证你离开时的代码库一定比来时更健康
- 以多态取代条件表达式
- 要点
    1. 小步快跑
    2. 手法：提炼函数，内联变量，搬移函数，以多态取代条件表达式

# 第2章 重构的原则
- 如果有人说他们的代码在重构过程中有一两天时间不可用，基本上可以确定，他们在做的事不是重构
- 两顶帽子：添加新功能；重构
- 如果没有重构，程序的内部设计会逐渐腐败变质。当人们只为短期目的而修改代码时，他们经常没有完全理解架构的整体设计，于是代码逐渐失去了自己的结构。程序员越来越难通过阅读源码来理解原来的设计。代码结构的流失有累积效应。
- 改进设计的一个重要方向就是消除重复代码
- 代码量减少并不会是系统运行更快，但是可以将未来可能的程序修改动作变得容易得多。代码越多，做正确的修改就越困难，因为有更多代码需要理解。
- 我在这里做了点修改，系统却不如预期那样工作，因为我没有修改另一处——哪里的代码做着几乎完全一样的事情。
- 重构提高编程速度：好的设计可以持续的高效增加累积功能。但是坏的设计，只在初期比较快，后面就越来越困难了

## 何时重构
- 三次法则：第一次尽管放手做；第二次就会产生反感；第三次在做类似的事情，就应该重构
- 预备性重构：让添加新功能更容易
    - 没有重复代码，修改只需要一次搞定
- 帮助理解的重构：让代码更易懂
    - 命名
- 何时不应该重构
    - 当一堆丑陋的代码能够隐藏在一个API下，就可以不用管。只有当需要理解其中原理时，对其重构才有价值
    - 重写比重构还容易，就别重构了
- 挑战
    - 延缓新功能开发
    - 代码所有权
        - 将函数改名，保留原来的申明，但是可以把旧接口标记为「不推荐使用」deprecated
    - 分支
        - 分支开发越久，合并就越困难
        - 持续集成（CI），基于主干分支开发。每个团队成员每天至少向主线集成一次。代价是必须保证主干分支的健康状态。特性开关
    - 测试：快速发现错误；完整的测试套件
    - 遗留代码：大多数人觉得，有一大笔遗产是件好事，但是从程序员的角度来看就不同了。
    - 数据库重构
- 自动化重构
    - IDEA



# 第3章 代码的坏味道

# 第4章 构筑测试体系


# 第5章 介绍重构名录

# 第6章 第一组重构


# 第7章 封装


# 第8章 搬移特性


# 第9章 重新组织数据


# 第10章 简化条件逻辑


# 第11章 重构API


# 第12章 处理继承关系

# FAQ
## 如果待重构的代码没有测试怎么办
- 添加测试用例

## CI怎么保证master分支的健康
