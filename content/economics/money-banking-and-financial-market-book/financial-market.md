---
title: "第二篇 金融市场"
layout: page
date: 2018-12-30

---

[TOC]

## 理解利率

### 现值(present value)
现值(折现值) 是为了未来的现金流量折算成当前的现金价值,从而可以进行比较。

第n期到期的现金流CF折现的现值PV为

$$
PV = \frac{CF}{(1+i)^n}
$$

i是利率/收益率等。

直观解释: n年后给你CF元, 市场利率为i,那么这笔钱的在现在的价值就是现值PV。


### 四种信用市场工具
- 普通贷款, 到期偿还本息: 普通一次性贷款
- 固定支付贷款, 定期偿付部分本金和利息: 例如房贷, 分期贷
- 息票债券, 每期偿还利息, 到期偿还票债券面值的债券: 国债
- 贴现发行的债券, 没有利息, 到期偿还票债券面值的债券。所以一般要以低于票面价格卖出, 一般的公司债券都是这样

### 到期收益率
将债务工具未来所有的现金流CF按照收益率 i 折算的现值如果等于价格,那么i就是到期收益率。

- 一次性借款N元,一年后偿付本息, 假设利息为i, 那么收益率就是i
- 如果分两年, 方案一,每年都按照利率i偿还利息,到期后偿还本金; 方案二,到期后一次性安年利率i还本付息, 这两种收益率还是i吗? 显然第一年的利息如果存银行或搞理财, 第二年还可以获得额外的收益, 但是第二年的利息并没有这个优势,这说明虽然每年的利率是一样的, 但是第一种方案收益率应该高一些, 这正是因为现金的时间价值不一样。在这个例子中, 假设每年的收益率为r(与利率i区分), 对于方案一,第一年的利息现值为 $( i N / (1+r) )$, 第二年的利息现值为 $( i N / (1+r)^2 )$,确实不一样, 第二年的本金的现值为 $( N/(1+r)^2 )$, 根据等式,未来全部的现金流的现值等于价格(也就是本金), 那么有
  
  $$
    N = \frac{i N }{(1+r)} + \frac{i N} {(1+r)^2} + \frac{N}{(1+r)^2} 
  $$
    
  所以到期收益率满足 
  $$
   1 = \frac{i} { 1+r } + \frac{1+i}{(1+r)^2 }
  $$
  可以通过解这个方程解出到期收益率 $(r = i)$, 也就是说 **到期收益率是把债务等效于按照每年付息, 到期偿还本金,这种还款方式的利率**!!再来看第二种方案, 很容易列出方程
  $$
  N = \frac{2i N} {(1+r)^2} + \frac{N}{(1+r)^2} 
  $$
  解出
  $$
  r = \sqrt{1 + 2i} - 1 \approx i - i^2 < i
  $$
  实际收益率是比年利率i小的。
- 等额本息, 到期收益率案例。以房贷为例, 100万元本金LV借款, 假设月利率为i, 按照每月等额本息方式还款n年, 每月还钱金额FP计算。
  $$
  LV = \frac{FP}{1+i} + \frac{FP}{(1+i)^2} + \frac{FP}{(1+i)^3} + ... + + \frac{FP}{(1+i)^{12n}}
  $$
  所以
  $$
  FP = LV / (\frac{1}{1+i} + \frac{1}{(1+i)^2} + \frac{1}{(1+i)^3} + ... + + \frac{1}{(1+i)^{12n}})
  $$
  以LV=1000000元为例,年利率为4.9%,那么月利率i=0.40833%,那么可以就算出 FP=5307元

```python
def calc_fp(lv, i, n):
  r = sum(1/pow(1 + i, k) for k in range(1, n+1))
  return lv / r

if __name__ == '__main__':
  print calc_fp(726000, 0.0325/12, 12*30) # 实际值 3159.60
  print calc_fp(940000, 0.0539/12, 12*30) # 实际值 5272.48
```
  
  假设以等额本金方式还款, 那么每月还款金额很好算, 就是等额本金+当月的剩余借款产生的利息。
  房贷计算参考[loan_calc.py](https://github.com/tracholar/)