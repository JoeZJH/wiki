<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
        <link rel="Stylesheet" type="text/css" href="/wiki/static/plugin/tipuesearch/css/tipuesearch.css">
        <link rel="stylesheet" href="/wiki/static/plugin/tipuesearch/css/normalize.css">
        <link rel="stylesheet" href="/wiki/static/plugin/tipuesearch/css/tipuesearch.css">
        <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
        <title>YARN学习 - Tracholar的个人wiki</title>
        <meta name="keywords" content="technology, machine learning, data mining, economics, accounting"/>
        <meta name="description" content="A wiki website of tracholar when I learned new knowledgy and technics."/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width" />

        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)'], ['$', '$']]}
        });
        </script>
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous"></script>

        <!-- Google Adsense -->
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-78529611-1', 'auto');
          ga('send', 'pageview');


            // Google Adsense Auto AD
            (adsbygoogle = window.adsbygoogle || []).push({});
            /*
             (adsbygoogle = window.adsbygoogle || []).push({
                  google_ad_client: "ca-pub-6300557868920774",
                  enable_page_level_ads: true
             });
             */
        </script>
    </head>

    <body>
        <div id="container">
            <div id="google-search" style="width:200px; float:right; margin: 20px 0;">
                <form action="//cse.google.com/cse" method="get" id="search-form">
                    <input type="hidden" name="cx" value="015970462532790426975:gqlen38ywus"/>
                    <input type="text" name="q"  style="line-height:20px; padding:4px;" placeholder="站内搜索"/>
                    <svg width="13" height="13" viewBox="0 0 13 13" style="position:relative; left: -20px;" onclick="document.getElementById('search-form').submit()">
                        <title>搜索</title>
                        <path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z">
                        </path>
                    </svg>
                </form>

            </div>
            
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#tools">tools</a>&nbsp;»&nbsp;YARN学习</div>
</div>
<div class="clearfix"></div>
<div id="title">YARN学习</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">关于</a></li>
<li><a href="#_2">开发指南</a></li>
<li><a href="#_3">参考</a></li>
</ul>
</div>
<h2 id="_1">关于</h2>
<p>YARN 是HADOOP2代，相比第一代产品，可以开发除了 MAPREDUCE 外更复杂的分布式程序，<br />
XGBoost on yarn 就是一个例子！</p>
<h2 id="_2">开发指南</h2>
<p><img src="/wiki/static/images/yarn-structure.png" style="float:left;width:500px" /></p>
<p>YARN 用 ResourceManager 来分配资源，NodeManager 来管理计算节点！<br />
ApplicationMaster 用于跟踪任务，管理每一个在YARN上运行的程序实例，<br />
通过调用 ResourceManager 和 NodeManager 进行管理。</p>
<p>要使用一个 YARN 集群，首先需要来自包含一个应用程序的客户的请求。ResourceManager 协商一个容器的必要资源，启动一个 ApplicationMaster 来表示已提交的应用程序。通过使用一个资源请求协议，ApplicationMaster 协商每个节点上供应用程序使用的资源容器。执行应用程序时，ApplicationMaster 监视容器直到完成。当应用程序完成时，ApplicationMaster 从 ResourceManager 注销其容器，执行周期就完成了。</p>
<p>具体而言，就是要创建一个 ApplicationMaster类，例如<a href="https://github.com/dmlc/dmlc-core/blob/master/tracker/yarn/src/main/java/org/apache/hadoop/yarn/dmlc/ApplicationMaster.java">XGBoost的例子</a>。</p>
<p>创建一个 <a href="https://github.com/dmlc/dmlc-core/blob/master/tracker/yarn/src/main/java/org/apache/hadoop/yarn/dmlc/Client.java">application submission client</a>，<br />
提交应用给 YARN 的 ResourceManager(RM)。<br />
这个步骤通过创建一个 YarnClient 实例实现！</p>
<p>Following are the important interfaces:</p>
<ul>
<li>Client&lt;--&gt;ResourceManager</li>
</ul>
<p>By using YarnClient objects.</p>
<ul>
<li>ApplicationMaster&lt;--&gt;ResourceManager</li>
</ul>
<p>By using AMRMClientAsync objects, handling events asynchronously by AMRMClientAsync.CallbackHandler</p>
<ul>
<li>ApplicationMaster&lt;--&gt;NodeManager</li>
</ul>
<p>Launch containers. Communicate with NodeManagers by using NMClientAsync objects, handling container events by NMClientAsync.CallbackHandler</p>
<p>一个简单的例子：</p>
<div class="hlcode"><pre><span></span><span class="c1">// Create yarnClient</span>
<span class="n">YarnClient</span> <span class="n">yarnClient</span> <span class="o">=</span> <span class="n">YarnClient</span><span class="o">.</span><span class="na">createYarnClient</span><span class="o">();</span>
<span class="n">yarnClient</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">conf</span><span class="o">);</span>
<span class="n">yarnClient</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

<span class="n">YarnClientApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="n">yarnClient</span><span class="o">.</span><span class="na">createApplication</span><span class="o">();</span>
<span class="n">GetNewApplicationResponse</span> <span class="n">appResponse</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="na">getNewApplicationResponse</span><span class="o">();</span>

<span class="cm">/**</span>
<span class="cm">- **ApplicationSubmissionContext**: defines all the information needed by the RM to launch the AM. A client needs to set the following into the context:</span>
<span class="cm">    - Application info: id, name</span>
<span class="cm">    - Queue, priority info: Queue to which the application will be submitted, the priority to be assigned for the application.</span>
<span class="cm">    - User: The user submitting the application</span>
<span class="cm">    - ContainerLaunchContext: The information defining the container in which the AM will be launched and run. The ContainerLaunchContext, as mentioned previously, defines all the required information needed to run the application such as the local *Resources (binaries, jars, files etc.), Environment settings (CLASSPATH etc.), the Command to be executed and security T*okens (RECT).</span>
<span class="cm">*/</span>
<span class="n">ApplicationSubmissionContext</span> <span class="n">appContext</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="na">getApplicationSubmissionContext</span><span class="o">();</span>
<span class="n">ApplicationId</span> <span class="n">appId</span> <span class="o">=</span> <span class="n">appContext</span><span class="o">.</span><span class="na">getApplicationId</span><span class="o">();</span>

<span class="n">appContext</span><span class="o">.</span><span class="na">setKeepContainersAcrossApplicationAttempts</span><span class="o">(</span><span class="n">keepContainers</span><span class="o">);</span>
<span class="n">appContext</span><span class="o">.</span><span class="na">setApplicationName</span><span class="o">(</span><span class="n">appName</span><span class="o">);</span>
</pre></div>


<p>ApplicationMaster 通过 AMRMClientAsync.CallbackHandler 处理资源相关事件，通常在 onContainersAllocated 事件启动任务。</p>
<p>本地文件可以通过 Client 上传到 HDFS，然后 ContainerLaunchContext.setLocalResources 创建为本地资源，进行调用！</p>
<h2 id="_3">参考</h2>
<ol>
<li>IBM博客 <a href="https://www.ibm.com/developerworks/cn/data/library/bd-hadoopyarn/index.html">https://www.ibm.com/developerworks/cn/data/library/bd-hadoopyarn/index.html</a></li>
<li><a href="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Hadoop: Writing YARN Applications</a></li>
</ol>
</div>
<div id="income">
    <!--img src="/wiki/static/images/support-qrcode.png" alt="支持我" style="max-width:300px;" /-->

    <ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-6300557868920774"
     data-ad-slot="6882414849"></ins>
</div>
<div id="content-footer">created in <span class="create-date date"> 2016-12-25 </span></div>

<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  id: location.pathname,
  title: 'YARN学习',
  owner: 'tracholar',
  repo: 'wiki',
  oauth: {
    client_id: '0cc0476e504b5e70ae7c',
    client_secret: 'ab98e39ef79469040057eba9c6b2b543b84c72ee',
  },
  // ...
  // For more available options, check out the documentation below
})

gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

        </div>
        <div id="footer">
            <span>
                Copyright © 2019 tracholar.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        

        <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?df74779713027375e7b79302fb72d7b0";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>


        <script src="/wiki/tipuesearch_content.js"></script>
        <script src="/wiki/static/plugin/tipuesearch/tipuesearch_set.js"></script>
        <script src="/wiki/static/plugin/tipuesearch/tipuesearch.min.js"></script>
    </body>
</html>